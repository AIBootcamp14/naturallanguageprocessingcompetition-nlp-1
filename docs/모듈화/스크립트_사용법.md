# ìŠ¤í¬ë¦½íŠ¸ ì‚¬ìš©ë²• ê°€ì´ë“œ

## ğŸ“‹ ëª©ì°¨
1. [ìŠ¤í¬ë¦½íŠ¸ ê°œìš”](#ìŠ¤í¬ë¦½íŠ¸-ê°œìš”)
2. [í•™ìŠµ ìŠ¤í¬ë¦½íŠ¸](#í•™ìŠµ-ìŠ¤í¬ë¦½íŠ¸)
3. [ì¶”ë¡  ìŠ¤í¬ë¦½íŠ¸](#ì¶”ë¡ -ìŠ¤í¬ë¦½íŠ¸)
4. [ì „ì²´ íŒŒì´í”„ë¼ì¸](#ì „ì²´-íŒŒì´í”„ë¼ì¸)

---

## ğŸ“ ìŠ¤í¬ë¦½íŠ¸ ê°œìš”

### ì‚¬ìš© ê°€ëŠ¥í•œ ìŠ¤í¬ë¦½íŠ¸

| ìŠ¤í¬ë¦½íŠ¸ | ì„¤ëª… | ìš©ë„ |
|---------|------|------|
| `train.py` | ëª¨ë¸ í•™ìŠµ | Config ê¸°ë°˜ í•™ìŠµ ì‹¤í–‰ |
| `inference.py` | ì¶”ë¡  ë° ì œì¶œ íŒŒì¼ ìƒì„± | í•™ìŠµëœ ëª¨ë¸ë¡œ ì˜ˆì¸¡ |
| `run_pipeline.py` | ì „ì²´ íŒŒì´í”„ë¼ì¸ | í•™ìŠµ + ì¶”ë¡  í•œ ë²ˆì— ì‹¤í–‰ |

### ì‹¤í–‰ í”Œë¡œìš°

```mermaid
graph TB
    A[ì‹¤í—˜ Config ì„ íƒ] --> B{ì‹¤í–‰ ë°©ì‹}

    B -->|í•™ìŠµë§Œ| C[train.py]
    B -->|ì¶”ë¡ ë§Œ| D[inference.py]
    B -->|ì „ì²´| E[run_pipeline.py]

    C --> F[í•™ìŠµëœ ëª¨ë¸]
    F --> D
    D --> G[ì œì¶œ íŒŒì¼]

    E --> H[í•™ìŠµ ì‹¤í–‰]
    H --> I[ì¶”ë¡  ì‹¤í–‰]
    I --> G

    style C fill:#c8e6c9
    style D fill:#bbdefb
    style E fill:#fff9c4
    style G fill:#ffccbc
```

---

## ğŸš€ í•™ìŠµ ìŠ¤í¬ë¦½íŠ¸

### ê¸°ë³¸ ì‚¬ìš©ë²•

```bash
# ê°€ìƒí™˜ê²½ í™œì„±í™”
source ~/.pyenv/versions/nlp_py3_11_9/bin/activate

# í•™ìŠµ ì‹¤í–‰
python scripts/train.py --experiment baseline_kobart
```

### ëª…ë ¹ì–´ ì˜µì…˜

```bash
python scripts/train.py --help
```

**ì˜µì…˜:**
- `--experiment` (í•„ìˆ˜): ì‹¤í—˜ ì´ë¦„ (Config íŒŒì¼ëª…)
- `--debug`: ë””ë²„ê·¸ ëª¨ë“œ (ì‘ì€ ë°ì´í„°ì…‹, 2 ì—í¬í¬, WandB ë¹„í™œì„±í™”)

### ì‚¬ìš© ì˜ˆì‹œ

#### 1. ê¸°ë³¸ í•™ìŠµ

```bash
python scripts/train.py --experiment baseline_kobart
```

**ì‹¤í–‰ ë‹¨ê³„:**
1. Config ë¡œë”© (`configs/experiments/baseline_kobart.yaml`)
2. ë°ì´í„° ë¡œë”© (train.csv, dev.csv)
3. ëª¨ë¸ ë¡œë”© (KoBART)
4. Dataset ìƒì„±
5. í•™ìŠµ ì‹¤í–‰ (WandB ë¡œê¹…)
6. ëª¨ë¸ ì €ì¥ (`outputs/baseline_kobart/`)

#### 2. ë””ë²„ê·¸ ëª¨ë“œ (ë¹ ë¥¸ í…ŒìŠ¤íŠ¸)

```bash
python scripts/train.py --experiment baseline_kobart --debug
```

**ë””ë²„ê·¸ ëª¨ë“œ ì„¤ì •:**
- ë°ì´í„°: í•™ìŠµ 100ê°œ, ê²€ì¦ 20ê°œë§Œ ì‚¬ìš©
- ì—í¬í¬: 2íšŒ
- ë°°ì¹˜ í¬ê¸°: 4
- WandB: ë¹„í™œì„±í™”

**ì¶œë ¥ ì˜ˆì‹œ:**
```
============================================================
í•™ìŠµ ì‹œì‘: baseline_kobart
============================================================

[1/6] Config ë¡œë”©...
  âš ï¸ ë””ë²„ê·¸ ëª¨ë“œ í™œì„±í™”
  âœ… Config ë¡œë“œ ì™„ë£Œ (seed: 42)

[2/6] ë°ì´í„° ë¡œë”©...
  âš ï¸ ë””ë²„ê·¸: í•™ìŠµ 100ê°œ, ê²€ì¦ 20ê°œ
  âœ… í•™ìŠµ ë°ì´í„°: 100ê°œ
  âœ… ê²€ì¦ ë°ì´í„°: 20ê°œ

[3/6] ëª¨ë¸ ë¡œë”©...
============================================================
ëª¨ë¸ ë° í† í¬ë‚˜ì´ì € ë¡œë”© ì‹œì‘
============================================================
í† í¬ë‚˜ì´ì € ë¡œë”©: digit82/kobart-summarization
ëª¨ë¸ ë¡œë”©: digit82/kobart-summarization
  â†’ ë””ë°”ì´ìŠ¤: cuda
  â†’ ì „ì²´ íŒŒë¼ë¯¸í„°: 123,859,968
  â†’ í•™ìŠµ ê°€ëŠ¥ íŒŒë¼ë¯¸í„°: 123,859,968
============================================================
âœ… ëª¨ë¸ ë° í† í¬ë‚˜ì´ì € ë¡œë”© ì™„ë£Œ
============================================================
  âœ… ëª¨ë¸ ë¡œë“œ ì™„ë£Œ

[4/6] Dataset ìƒì„±...
  âœ… í•™ìŠµ Dataset: 100ê°œ
  âœ… ê²€ì¦ Dataset: 20ê°œ

[5/6] í•™ìŠµ ì‹œì‘...
============================================================
ëª¨ë¸ í•™ìŠµ ì‹œì‘
============================================================

í•™ìŠµ ì§„í–‰ ì¤‘...
[í•™ìŠµ ë¡œê·¸...]

ìµœì¢… ëª¨ë¸ ì €ì¥ ì¤‘...
  â†’ ëª¨ë¸ ì €ì¥ ìœ„ì¹˜: outputs/baseline_kobart/final_model

ìµœì¢… í‰ê°€ ì¤‘...

ìµœì¢… í‰ê°€ ê²°ê³¼:
  eval_rouge1: 0.3456
  eval_rouge2: 0.1234
  eval_rougeL: 0.2890
  eval_rouge_sum: 0.7580

============================================================
âœ… í•™ìŠµ ì™„ë£Œ!
============================================================

[6/6] í•™ìŠµ ì™„ë£Œ!
  ìµœì¢… ëª¨ë¸ ì €ì¥: outputs/baseline_kobart/final_model
  ìµœìƒ ì²´í¬í¬ì¸íŠ¸: outputs/baseline_kobart/checkpoint-100

  ìµœì¢… í‰ê°€ ê²°ê³¼:
    eval_rouge1: 0.3456
    eval_rouge2: 0.1234
    eval_rougeL: 0.2890
    eval_rouge_sum: 0.7580

============================================================
ğŸ‰ í•™ìŠµ ì™„ë£Œ!
============================================================
```

---

## ğŸ”® ì¶”ë¡  ìŠ¤í¬ë¦½íŠ¸

### ê¸°ë³¸ ì‚¬ìš©ë²•

```bash
python scripts/inference.py \
    --model outputs/baseline_kobart/final_model \
    --output submissions/submission.csv
```

### ëª…ë ¹ì–´ ì˜µì…˜

```bash
python scripts/inference.py --help
```

**ì˜µì…˜:**
- `--model` (í•„ìˆ˜): ëª¨ë¸ ì²´í¬í¬ì¸íŠ¸ ê²½ë¡œ
- `--output` (í•„ìˆ˜): ì œì¶œ íŒŒì¼ ì¶œë ¥ ê²½ë¡œ
- `--test_data`: í…ŒìŠ¤íŠ¸ ë°ì´í„° ê²½ë¡œ (ê¸°ë³¸: `data/raw/test.csv`)
- `--batch_size`: ì¶”ë¡  ë°°ì¹˜ í¬ê¸° (ê¸°ë³¸: 32)
- `--num_beams`: Beam search ë¹” ê°œìˆ˜ (ê¸°ë³¸: 4)
- `--experiment`: Config ì´ë¦„ (ìƒì„± íŒŒë¼ë¯¸í„°ìš©, ê¸°ë³¸: `baseline_kobart`)

### ì‚¬ìš© ì˜ˆì‹œ

#### 1. ê¸°ë³¸ ì¶”ë¡ 

```bash
python scripts/inference.py \
    --model outputs/baseline_kobart/final_model \
    --output submissions/submission.csv
```

#### 2. íŠ¹ì • ì²´í¬í¬ì¸íŠ¸ ì‚¬ìš©

```bash
python scripts/inference.py \
    --model outputs/baseline_kobart/checkpoint-1000 \
    --output submissions/checkpoint_1000.csv
```

#### 3. ì¶”ë¡  íŒŒë¼ë¯¸í„° ì¡°ì •

```bash
python scripts/inference.py \
    --model outputs/baseline_kobart/final_model \
    --output submissions/submission.csv \
    --batch_size 16 \
    --num_beams 8
```

**ì¶œë ¥ ì˜ˆì‹œ:**
```
============================================================
ì¶”ë¡  ì‹œì‘
============================================================

[1/5] Config ë¡œë”©...
  âœ… Config ë¡œë“œ ì™„ë£Œ: baseline_kobart

[2/5] ëª¨ë¸ ë¡œë”©: outputs/baseline_kobart/final_model
  âœ… ëª¨ë¸ ë¡œë“œ ì™„ë£Œ
  ëª¨ë¸ íŒŒë¼ë¯¸í„°: 123,859,968

[3/5] í…ŒìŠ¤íŠ¸ ë°ì´í„° ë¡œë”©: data/raw/test.csv
  âœ… í…ŒìŠ¤íŠ¸ ìƒ˜í”Œ: 2500ê°œ

[4/5] ì¶”ë¡  ì‹¤í–‰...
============================================================
ì œì¶œ íŒŒì¼ ìƒì„± ì‹œì‘
============================================================

ìƒ˜í”Œ ìˆ˜: 2500
Predicting: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 79/79 [02:15<00:00,  1.71s/it]

âœ… ì œì¶œ íŒŒì¼ ì €ì¥ ì™„ë£Œ: submissions/submission.csv
============================================================

[5/5] ì¶”ë¡  ì™„ë£Œ!
  âœ… ì œì¶œ íŒŒì¼ ìƒì„±: submissions/submission.csv
  ìƒ˜í”Œ ìˆ˜: 2500

  ìƒ˜í”Œ ì˜ˆì¸¡ ê²°ê³¼ (ì²˜ìŒ 3ê°œ):
    [test_001]: ë‘ ì‚¬ëŒì´ ì¸ì‚¬ë¥¼ ë‚˜ëˆ„ì—ˆë‹¤...
    [test_002]: ë‚ ì”¨ê°€ ì¢‹ì•„ì„œ ì‚°ì±…ì„ ê°€ê¸°ë¡œ í–ˆë‹¤...
    [test_003]: ì ì‹¬ ë©”ë‰´ë¡œ ê¹€ì¹˜ì°Œê°œë¥¼ ì„ íƒí–ˆë‹¤...

============================================================
ğŸ‰ ì¶”ë¡  ì™„ë£Œ!
============================================================
```

---

## ğŸ”„ ì „ì²´ íŒŒì´í”„ë¼ì¸

### ê¸°ë³¸ ì‚¬ìš©ë²•

```bash
python scripts/run_pipeline.py --experiment baseline_kobart
```

### ëª…ë ¹ì–´ ì˜µì…˜

**ì˜µì…˜:**
- `--experiment` (í•„ìˆ˜): ì‹¤í—˜ ì´ë¦„
- `--skip_training`: í•™ìŠµ ê±´ë„ˆë›°ê¸° (ê¸°ì¡´ ëª¨ë¸ ì‚¬ìš©)
- `--model_path`: ì¶”ë¡ ì— ì‚¬ìš©í•  ëª¨ë¸ ê²½ë¡œ (skip_training ì‹œ í•„ìˆ˜)
- `--output`: ì œì¶œ íŒŒì¼ ì¶œë ¥ ê²½ë¡œ (ê¸°ë³¸: `submissions/submission.csv`)

### ì‚¬ìš© ì˜ˆì‹œ

#### 1. ì „ì²´ íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ (í•™ìŠµ + ì¶”ë¡ )

```bash
python scripts/run_pipeline.py --experiment baseline_kobart
```

**ì‹¤í–‰ í”Œë¡œìš°:**
```
[ë‹¨ê³„ 1/2] í•™ìŠµ ì‹œì‘
  â†’ train.py ì‹¤í–‰
  â†’ ëª¨ë¸ ì €ì¥: outputs/baseline_kobart/final_model

[ë‹¨ê³„ 2/2] ì¶”ë¡  ì‹œì‘
  â†’ inference.py ì‹¤í–‰
  â†’ ì œì¶œ íŒŒì¼: submissions/submission.csv

ğŸ‰ ì „ì²´ íŒŒì´í”„ë¼ì¸ ì™„ë£Œ!
```

#### 2. ì¶”ë¡ ë§Œ ì‹¤í–‰ (í•™ìŠµ ê±´ë„ˆë›°ê¸°)

```bash
python scripts/run_pipeline.py \
    --experiment baseline_kobart \
    --skip_training \
    --model_path outputs/baseline_kobart/final_model \
    --output submissions/submission_v2.csv
```

---

## ğŸ“Š ì‹¤í–‰ ì‹œê°„ ì˜ˆìƒ

### í•™ìŠµ (train.py)

| ì„¤ì • | ë°ì´í„° í¬ê¸° | ì—í¬í¬ | ì˜ˆìƒ ì‹œê°„ (A6000) |
|------|-----------|--------|------------------|
| ë””ë²„ê·¸ ëª¨ë“œ | 100ê°œ | 2 | ~2ë¶„ |
| ì „ì²´ (baseline) | 12,457ê°œ | 20 | ~4-6ì‹œê°„ |

### ì¶”ë¡  (inference.py)

| ë°ì´í„° í¬ê¸° | ë°°ì¹˜ í¬ê¸° | ì˜ˆìƒ ì‹œê°„ (A6000) |
|-----------|---------|------------------|
| 2,500ê°œ | 32 | ~3-5ë¶„ |
| 2,500ê°œ | 16 | ~5-7ë¶„ |

---

## ğŸ› ë¬¸ì œ í•´ê²°

### ë¬¸ì œ 1: CUDA out of memory (í•™ìŠµ)

```bash
# í•´ê²°: ë””ë²„ê·¸ ëª¨ë“œë¡œ í…ŒìŠ¤íŠ¸
python scripts/train.py --experiment baseline_kobart --debug

# ë˜ëŠ” Config ìˆ˜ì •
# configs/experiments/baseline_kobart.yaml
training:
  batch_size: 16  # 50 â†’ 16ìœ¼ë¡œ ì¤„ì´ê¸°
```

### ë¬¸ì œ 2: WandB ë¡œê·¸ì¸ í•„ìš”

```bash
# í•´ê²° 1: WandB ë¡œê·¸ì¸
wandb login

# í•´ê²° 2: ë””ë²„ê·¸ ëª¨ë“œ ì‚¬ìš© (WandB ìë™ ë¹„í™œì„±í™”)
python scripts/train.py --experiment baseline_kobart --debug
```

### ë¬¸ì œ 3: ëª¨ë¸ ê²½ë¡œ ì°¾ì„ ìˆ˜ ì—†ìŒ (ì¶”ë¡ )

```bash
# í•´ê²°: ì •í™•í•œ ê²½ë¡œ í™•ì¸
ls -la outputs/baseline_kobart/

# ì˜¬ë°”ë¥¸ ê²½ë¡œ ì‚¬ìš©
python scripts/inference.py \
    --model outputs/baseline_kobart/final_model \
    --output submissions/submission.csv
```

---

## ğŸ’¡ ì‹¤ì „ í™œìš© íŒ¨í„´

### íŒ¨í„´ 1: ë¹ ë¥¸ í”„ë¡œí† íƒ€ì… í…ŒìŠ¤íŠ¸

```bash
# 1. ë””ë²„ê·¸ ëª¨ë“œë¡œ ë¹ ë¥¸ í•™ìŠµ
python scripts/train.py --experiment baseline_kobart --debug

# 2. í•™ìŠµëœ ëª¨ë¸ë¡œ ì¶”ë¡  í…ŒìŠ¤íŠ¸
python scripts/inference.py \
    --model outputs/baseline_kobart/final_model \
    --output submissions/debug_test.csv \
    --batch_size 4
```

### íŒ¨í„´ 2: ì—¬ëŸ¬ ì²´í¬í¬ì¸íŠ¸ ë¹„êµ

```bash
# ê° ì²´í¬í¬ì¸íŠ¸ë¡œ ì¶”ë¡  ì‹¤í–‰
for checkpoint in checkpoint-500 checkpoint-1000 checkpoint-1500 final_model
do
    python scripts/inference.py \
        --model outputs/baseline_kobart/$checkpoint \
        --output submissions/${checkpoint}.csv
done
```

### íŒ¨í„´ 3: í•˜ì´í¼íŒŒë¼ë¯¸í„° ì‹¤í—˜

```bash
# ì‹¤í—˜ 1: ë†’ì€ learning rate
python scripts/train.py --experiment high_lr_kobart

# ì‹¤í—˜ 2: í° ë°°ì¹˜ í¬ê¸°
python scripts/train.py --experiment large_batch_kobart

# ê° ì‹¤í—˜ ê²°ê³¼ ì¶”ë¡ 
python scripts/inference.py --model outputs/high_lr_kobart/final_model --output submissions/high_lr.csv
python scripts/inference.py --model outputs/large_batch_kobart/final_model --output submissions/large_batch.csv
```

---

## ğŸ”— ê´€ë ¨ ë¬¸ì„œ

- [00_ì „ì²´_ì‹œìŠ¤í…œ_ê°œìš”.md](./00_ì „ì²´_ì‹œìŠ¤í…œ_ê°œìš”.md) - ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜
- [ë¹ ë¥¸_ì‹œì‘_ê°€ì´ë“œ.md](./ë¹ ë¥¸_ì‹œì‘_ê°€ì´ë“œ.md) - 5ë¶„ ì•ˆì— ì‹œì‘í•˜ê¸°

---