# ì²´í¬í¬ì¸íŠ¸ ì¬ì‚¬ìš© ëª…ë ¹ì–´ ê°€ì´ë“œ

K-Fold ì•™ìƒë¸” ì¶”ë¡  íŒŒì´í”„ë¼ì¸ì—ì„œ ì²´í¬í¬ì¸íŠ¸ë¥¼ ì¬ì‚¬ìš©í•˜ì—¬ íŠ¹ì • ë‹¨ê³„ë¶€í„° ì´ì–´ì„œ ì‹¤í–‰í•˜ëŠ” ë°©ë²•ì„ ì•ˆë‚´í•©ë‹ˆë‹¤.

---

## ğŸ“‚ ì²´í¬í¬ì¸íŠ¸ íŒŒì¼ êµ¬ì¡°

ê° ì‹¤í—˜ í´ë”ì˜ `checkpoints/` ë””ë ‰í† ë¦¬ì—ëŠ” ë‹¤ìŒê³¼ ê°™ì€ íŒŒì¼ë“¤ì´ ì €ì¥ë©ë‹ˆë‹¤:

```
experiments/{ë‚ ì§œ}/{ì‹¤í—˜ëª…}/checkpoints/
â”œâ”€â”€ kfold_checkpoint.pkl              # K-Fold ì•™ìƒë¸” ê²°ê³¼ (pickle)
â”œâ”€â”€ kfold_summaries.csv               # K-Fold ì•™ìƒë¸” ê²°ê³¼ (CSV)
â”œâ”€â”€ hf_correction_checkpoint.pkl      # HuggingFace ë³´ì • ê²°ê³¼ (pickle)
â”œâ”€â”€ hf_correction_summaries.csv       # HuggingFace ë³´ì • ê²°ê³¼ (CSV)
â”œâ”€â”€ solar_api_checkpoint.pkl          # Solar API ì•™ìƒë¸” ê²°ê³¼ (pickle)
â””â”€â”€ solar_api_summaries.csv           # Solar API ì•™ìƒë¸” ê²°ê³¼ (CSV)
```

---

## ğŸ¯ ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: K-Fold ì™„ë£Œ â†’ Solar APIë§Œ ì‹¤í–‰

**ìƒí™©**: K-Fold ì•™ìƒë¸”ì€ ì´ë¯¸ ì™„ë£Œí–ˆê³ , Solar API ì•™ìƒë¸”ë§Œ ì¶”ê°€ë¡œ ì‹¤í–‰í•˜ê³  ì‹¶ì„ ë•Œ

**ì˜ˆì‹œ ì‹¤í—˜ í´ë”**: `experiments/20251015/20251015_130751_inference_kobart_kfold_soft_voting_bs32_maxnew110_hf_solar`

#### ëª…ë ¹ì–´ (solar-1-mini-chat - ê¶Œì¥)

```bash
python scripts/kfold_ensemble_inference.py \
  --experiment_dir experiments/20251014/20251014_183206_kobart_ultimate_kfold \
  --test_data data/raw/test.csv \
  --kfold_checkpoint experiments/20251015/20251015_130751_inference_kobart_kfold_soft_voting_bs32_maxnew110_hf_solar/checkpoints/kfold_checkpoint.pkl \
  --skip_kfold \
  --use_solar_api \
  --solar_model solar-1-mini-chat \
  --solar_temperature 0.1 \
  --solar_use_voting \
  --solar_n_samples 5 \
  --solar_delay 3.0 \
  --max_new_tokens 110 \
  --min_new_tokens 30 \
  --num_beams 5 \
  --length_penalty 1.0 \
  --repetition_penalty 1.5 \
  --no_repeat_ngram_size 3 \
  --batch_size 16 \
  --ensemble_method soft_voting \
  --resume
```

**ì˜ˆìƒ ì‹œê°„**: ì•½ 2-3ì‹œê°„ (499ê°œ ìƒ˜í”Œ, 5íšŒ ìƒ˜í”Œë§ ê¸°ì¤€)

---

#### ëª…ë ¹ì–´ (solar-pro2 - ìµœê³  í’ˆì§ˆ)

```bash
python scripts/kfold_ensemble_inference.py \
  --experiment_dir experiments/20251014/20251014_183206_kobart_ultimate_kfold \
  --test_data data/raw/test.csv \
  --kfold_checkpoint experiments/20251015/20251015_130751_inference_kobart_kfold_soft_voting_bs32_maxnew110_hf_solar/checkpoints/kfold_checkpoint.pkl \
  --skip_kfold \
  --use_solar_api \
  --solar_model solar-pro2 \
  --solar_temperature 0.1 \
  --solar_use_voting \
  --solar_n_samples 5 \
  --solar_delay 3.0 \
  --max_new_tokens 110 \
  --min_new_tokens 30 \
  --num_beams 5 \
  --length_penalty 1.0 \
  --repetition_penalty 1.5 \
  --no_repeat_ngram_size 3 \
  --batch_size 16 \
  --ensemble_method soft_voting \
  --resume
```

**ì˜ˆìƒ ì‹œê°„**: ì•½ 4-5ì‹œê°„ (499ê°œ ìƒ˜í”Œ, 5íšŒ ìƒ˜í”Œë§ ê¸°ì¤€)

---

### ì‹œë‚˜ë¦¬ì˜¤ 2: HuggingFace ë³´ì •ê¹Œì§€ ì™„ë£Œ â†’ Solar APIë§Œ ì‹¤í–‰

**ìƒí™©**: K-Fold ì•™ìƒë¸” + HuggingFace ë³´ì •ê¹Œì§€ ì™„ë£Œí–ˆê³ , Solar APIë§Œ ì¶”ê°€ë¡œ ì‹¤í–‰í•˜ê³  ì‹¶ì„ ë•Œ

#### ëª…ë ¹ì–´

```bash
python scripts/kfold_ensemble_inference.py \
  --experiment_dir experiments/20251014/20251014_183206_kobart_ultimate_kfold \
  --test_data data/raw/test.csv \
  --kfold_checkpoint experiments/20251015/20251015_130751_inference_kobart_kfold_soft_voting_bs32_maxnew110_hf_solar/checkpoints/hf_correction_checkpoint.pkl \
  --skip_kfold \
  --use_solar_api \
  --solar_model solar-1-mini-chat \
  --solar_temperature 0.1 \
  --solar_use_voting \
  --solar_n_samples 5 \
  --solar_delay 3.0 \
  --max_new_tokens 110 \
  --min_new_tokens 30 \
  --num_beams 5 \
  --length_penalty 1.0 \
  --repetition_penalty 1.5 \
  --no_repeat_ngram_size 3 \
  --batch_size 16 \
  --ensemble_method soft_voting \
  --resume
```

**ì°¨ì´ì **: `hf_correction_checkpoint.pkl` ì‚¬ìš© â†’ HuggingFace ë³´ì • ê²°ê³¼ë¶€í„° ì‹œì‘

---

### ì‹œë‚˜ë¦¬ì˜¤ 3: Solar API ì¤‘ë‹¨ í›„ ì¬ê°œ

**ìƒí™©**: Solar API ì‹¤í–‰ ì¤‘ ì¤‘ë‹¨ë˜ì–´ ì´ì–´ì„œ ì‹¤í–‰í•˜ê³  ì‹¶ì„ ë•Œ

#### ëª…ë ¹ì–´

```bash
python scripts/kfold_ensemble_inference.py \
  --experiment_dir experiments/20251014/20251014_183206_kobart_ultimate_kfold \
  --test_data data/raw/test.csv \
  --use_solar_api \
  --solar_model solar-1-mini-chat \
  --solar_temperature 0.1 \
  --solar_use_voting \
  --solar_n_samples 5 \
  --solar_delay 3.0 \
  --max_new_tokens 110 \
  --min_new_tokens 30 \
  --num_beams 5 \
  --length_penalty 1.0 \
  --repetition_penalty 1.5 \
  --no_repeat_ngram_size 3 \
  --batch_size 16 \
  --ensemble_method soft_voting \
  --resume
```

**ì°¸ê³ **:
- `--resume` í”Œë˜ê·¸ë§Œ ì‚¬ìš©
- ìë™ìœ¼ë¡œ ë§ˆì§€ë§‰ ì²´í¬í¬ì¸íŠ¸ë¶€í„° ì¬ê°œ
- ë™ì¼í•œ ì‹¤í—˜ í´ë”ì—ì„œ ì‹¤í–‰í•´ì•¼ í•¨

---

### ì‹œë‚˜ë¦¬ì˜¤ 4: K-Foldë§Œ ì‹¤í–‰ (Solar API/HuggingFace ì œì™¸)

**ìƒí™©**: K-Fold ì•™ìƒë¸”ë§Œ ë¹ ë¥´ê²Œ ì‹¤í–‰í•˜ê³  ì‹¶ì„ ë•Œ

#### ëª…ë ¹ì–´

```bash
python scripts/kfold_ensemble_inference.py \
  --experiment_dir experiments/20251014/20251014_183206_kobart_ultimate_kfold \
  --test_data data/raw/test.csv \
  --max_new_tokens 110 \
  --min_new_tokens 30 \
  --num_beams 5 \
  --length_penalty 1.0 \
  --repetition_penalty 1.5 \
  --no_repeat_ngram_size 3 \
  --batch_size 16 \
  --ensemble_method soft_voting \
  --resume
```

**íŠ¹ì§•**:
- `--use_solar_api` ì—†ìŒ â†’ Solar API ê±´ë„ˆëœ€
- `--use_pretrained_correction` ì—†ìŒ â†’ HuggingFace ë³´ì • ê±´ë„ˆëœ€
- K-Fold ì•™ìƒë¸” ê²°ê³¼ê°€ ë°”ë¡œ ì œì¶œ íŒŒì¼ë¡œ ì €ì¥

---

## ğŸ”‘ í•µì‹¬ ì˜µì…˜ ì„¤ëª…

### 1. ì²´í¬í¬ì¸íŠ¸ ì¬ì‚¬ìš© ì˜µì…˜

| ì˜µì…˜ | ì„¤ëª… | ì˜ˆì‹œ |
|------|------|------|
| `--kfold_checkpoint` | ì¬ì‚¬ìš©í•  K-Fold ì²´í¬í¬ì¸íŠ¸ ê²½ë¡œ | `experiments/.../checkpoints/kfold_checkpoint.pkl` |
| `--skip_kfold` | K-Fold ì•™ìƒë¸” ê±´ë„ˆë›°ê¸° (ì²´í¬í¬ì¸íŠ¸ í•„ìˆ˜) | í”Œë˜ê·¸ |
| `--resume` | ì´ì–´ì„œ ì‹¤í–‰ (ìë™ ì²´í¬í¬ì¸íŠ¸ ê°ì§€) | í”Œë˜ê·¸ |

### 2. Solar API ì˜µì…˜

| ì˜µì…˜ | ì„¤ëª… | ê¶Œì¥ê°’ | ë¹„ê³  |
|------|------|--------|------|
| `--solar_model` | Solar ëª¨ë¸ ì„ íƒ | `solar-1-mini-chat` | `solar-pro2`ëŠ” ëŠë¦¼ |
| `--solar_temperature` | ìƒì„± ì˜¨ë„ (ë‚®ì„ìˆ˜ë¡ ì¼ê´€ì„±) | `0.1` | v3.5 ìµœì í™”ê°’ |
| `--solar_use_voting` | ë‹¤ì¤‘ ìƒ˜í”Œë§ ì‚¬ìš© | í”Œë˜ê·¸ | í’ˆì§ˆ í–¥ìƒ |
| `--solar_n_samples` | ìƒ˜í”Œë§ íšŸìˆ˜ | `5` | 3-5íšŒ ê¶Œì¥ |
| `--solar_delay` | ë°°ì¹˜ ê°„ ëŒ€ê¸° ì‹œê°„ (ì´ˆ) | `3.0` | Rate limit ë°©ì§€ |

### 3. ìƒì„± íŒŒë¼ë¯¸í„°

| ì˜µì…˜ | ì„¤ëª… | ê¶Œì¥ê°’ |
|------|------|--------|
| `--max_new_tokens` | ìƒì„±í•  ìµœëŒ€ í† í° ìˆ˜ | `110` |
| `--min_new_tokens` | ìƒì„±í•  ìµœì†Œ í† í° ìˆ˜ | `30` |
| `--num_beams` | Beam search ë¹” ê°œìˆ˜ | `5` |
| `--length_penalty` | ê¸¸ì´ í˜ë„í‹° | `1.0` |
| `--repetition_penalty` | ë°˜ë³µ ì–µì œ ê°•ë„ | `1.5` |
| `--no_repeat_ngram_size` | ë°˜ë³µ ê¸ˆì§€ n-gram í¬ê¸° | `3` |

---

## ğŸ“Š ëª¨ë¸ë³„ ì„±ëŠ¥ ë° ì‹œê°„ ë¹„êµ

| ëª¨ë¸ | í’ˆì§ˆ | ì†ë„ | ì˜ˆìƒ ì‹œê°„ (499ê°œ, 5íšŒ ìƒ˜í”Œë§) | ë¹„ê³  |
|------|------|------|-------------------------------|------|
| `solar-1-mini-chat` | â­â­â­â­ | âš¡âš¡âš¡ | 2-3ì‹œê°„ | **ê¶Œì¥** - í’ˆì§ˆ/ì†ë„ ê· í˜• |
| `solar-pro2` | â­â­â­â­â­ | âš¡ | 4-5ì‹œê°„ | ìµœê³  í’ˆì§ˆ, ë§¤ìš° ëŠë¦¼ |
| KoBARTë§Œ | â­â­â­ | âš¡âš¡âš¡âš¡âš¡ | 10-15ë¶„ | Solar ì—†ì´ ë¹ ë¥¸ í…ŒìŠ¤íŠ¸ |

---

## ğŸ› ï¸ ì²´í¬í¬ì¸íŠ¸ í™•ì¸ ë°©ë²•

### 1. ì²´í¬í¬ì¸íŠ¸ íŒŒì¼ ì¡´ì¬ í™•ì¸

```bash
# K-Fold ì²´í¬í¬ì¸íŠ¸
ls -lh experiments/20251015/20251015_130751_*/checkpoints/kfold_checkpoint.pkl

# HuggingFace ì²´í¬í¬ì¸íŠ¸
ls -lh experiments/20251015/20251015_130751_*/checkpoints/hf_correction_checkpoint.pkl

# Solar API ì²´í¬í¬ì¸íŠ¸
ls -lh experiments/20251015/20251015_130751_*/checkpoints/solar_api_checkpoint.pkl
```

### 2. CSV íŒŒì¼ë¡œ ì§„í–‰ ìƒí™© í™•ì¸

```bash
# K-Fold ê²°ê³¼ í™•ì¸
head experiments/20251015/20251015_130751_*/checkpoints/kfold_summaries.csv

# HuggingFace ë³´ì • ê²°ê³¼ í™•ì¸
head experiments/20251015/20251015_130751_*/checkpoints/hf_correction_summaries.csv

# Solar API ê²°ê³¼ í™•ì¸
head experiments/20251015/20251015_130751_*/checkpoints/solar_api_summaries.csv
```

### 3. ìš”ì•½ ê°œìˆ˜ í™•ì¸

```bash
# CSV íŒŒì¼ ë¼ì¸ ìˆ˜ í™•ì¸ (í—¤ë” ì œì™¸í•˜ë©´ -1)
wc -l experiments/20251015/20251015_130751_*/checkpoints/*.csv
```

**ì •ìƒ ì¶œë ¥ ì˜ˆì‹œ**:
```
500 kfold_summaries.csv         # 1 (í—¤ë”) + 499 (ë°ì´í„°)
500 hf_correction_summaries.csv
500 solar_api_summaries.csv
```

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### 1. ì²´í¬í¬ì¸íŠ¸ ê²½ë¡œ í™•ì¸
- **ì ˆëŒ€ ê²½ë¡œ** ë˜ëŠ” **ì •í™•í•œ ìƒëŒ€ ê²½ë¡œ** ì‚¬ìš©
- ì‹¤í—˜ í´ë”ëª…ì— íƒ€ì„ìŠ¤íƒ¬í”„ê°€ í¬í•¨ë˜ë¯€ë¡œ ì£¼ì˜

### 2. íŒŒë¼ë¯¸í„° ì¼ê´€ì„±
- ì²´í¬í¬ì¸íŠ¸ì™€ **ë™ì¼í•œ generation íŒŒë¼ë¯¸í„°** ê¶Œì¥
- ë‹¤ë¥¸ íŒŒë¼ë¯¸í„° ì‚¬ìš© ì‹œ ì¼ê´€ì„± ì €í•˜ ê°€ëŠ¥

### 3. Resume vs ì²´í¬í¬ì¸íŠ¸ ì¬ì‚¬ìš©
| ë°©ë²• | ì‚¬ìš© ì‹œì  | ìƒˆ ì‹¤í—˜ í´ë” | ì²´í¬í¬ì¸íŠ¸ ê²½ë¡œ |
|------|-----------|--------------|----------------|
| `--resume` | ê°™ì€ ì‹¤í—˜ ì´ì–´ì„œ ì‹¤í–‰ | âŒ ë™ì¼ í´ë” | ìë™ ê°ì§€ |
| `--kfold_checkpoint` + `--skip_kfold` | ë‹¤ë¥¸ ì‹¤í—˜ì—ì„œ K-Fold ì¬ì‚¬ìš© | âœ… ìƒˆ í´ë” ìƒì„± | ìˆ˜ë™ ì§€ì • |

### 4. Solar API Rate Limit
- v3.5ì—ì„œ **ìë™ ì¬ì‹œë„ ë¡œì§** ì¶”ê°€
- 429 ì—ëŸ¬ ë°œìƒ ì‹œ 5ì´ˆ â†’ 10ì´ˆ â†’ 20ì´ˆ ëŒ€ê¸° í›„ ì¬ì‹œë„
- ì•ˆì •ì ìœ¼ë¡œ ì‹¤í–‰ ê°€ëŠ¥

---

## ğŸ¯ ì‹¤ì „ ì˜ˆì‹œ

### ì˜ˆì‹œ 1: ë¹ ë¥¸ í”„ë¡œí† íƒ€ì´í•‘

```bash
# 1ë‹¨ê³„: K-Foldë§Œ ë¹ ë¥´ê²Œ ì‹¤í–‰
python scripts/kfold_ensemble_inference.py \
  --experiment_dir experiments/20251014/20251014_183206_kobart_ultimate_kfold \
  --test_data data/raw/test.csv \
  --max_new_tokens 110 \
  --batch_size 16 \
  --resume

# 2ë‹¨ê³„: ê²°ê³¼ í™•ì¸ í›„ Solar API ì¶”ê°€ (ì²´í¬í¬ì¸íŠ¸ ì¬ì‚¬ìš©)
python scripts/kfold_ensemble_inference.py \
  --experiment_dir experiments/20251014/20251014_183206_kobart_ultimate_kfold \
  --test_data data/raw/test.csv \
  --kfold_checkpoint experiments/20251015/{ìƒì„±ëœí´ë”}/checkpoints/kfold_checkpoint.pkl \
  --skip_kfold \
  --use_solar_api \
  --solar_model solar-1-mini-chat \
  --solar_use_voting \
  --solar_n_samples 3 \
  --resume
```

### ì˜ˆì‹œ 2: ê³ í’ˆì§ˆ ìµœì¢… ì œì¶œ

```bash
# K-Fold + HuggingFace + Solar Pro2 (ìµœê³  í’ˆì§ˆ)
python scripts/kfold_ensemble_inference.py \
  --experiment_dir experiments/20251014/20251014_183206_kobart_ultimate_kfold \
  --test_data data/raw/test.csv \
  --use_pretrained_correction \
  --correction_models gogamza/kobart-base-v2 digit82/kobart-summarization \
  --use_solar_api \
  --solar_model solar-pro2 \
  --solar_temperature 0.1 \
  --solar_use_voting \
  --solar_n_samples 5 \
  --max_new_tokens 110 \
  --batch_size 16 \
  --resume
```

### ì˜ˆì‹œ 3: A/B í…ŒìŠ¤íŠ¸ (ëª¨ë¸ ë¹„êµ)

```bash
# Aì•ˆ: solar-1-mini-chat
python scripts/kfold_ensemble_inference.py \
  --kfold_checkpoint {ì²´í¬í¬ì¸íŠ¸ê²½ë¡œ} \
  --skip_kfold \
  --use_solar_api \
  --solar_model solar-1-mini-chat \
  --solar_n_samples 5 \
  --resume

# Bì•ˆ: solar-pro2
python scripts/kfold_ensemble_inference.py \
  --kfold_checkpoint {ì²´í¬í¬ì¸íŠ¸ê²½ë¡œ} \
  --skip_kfold \
  --use_solar_api \
  --solar_model solar-pro2 \
  --solar_n_samples 5 \
  --resume
```

---

## ğŸ“š ê´€ë ¨ ë¬¸ì„œ

- **Solar API ìµœì í™”**: `docs/issues/Solar_API_Rate_Limit_ë°_ì´ë¦„íŒ¨í„´_ìˆ˜ì •_v3.5.md`
- **í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§**: `docs/issues/Solar_API_í”Œë ˆì´ìŠ¤í™€ë”_ì œê±°_v2.md`
- **ì‹¤í—˜ ëª…ë ¹ì–´ ê²€ì¦**: `docs/usage/ëª…ë ¹ì–´_ê²€ì¦_solar_pro2.md`
- **CSV ì²´í¬í¬ì¸íŠ¸ ê¸°ëŠ¥**: ì»¤ë°‹ `16f31c7`

---

## ğŸ’¡ íŒ

1. **ê°œë°œ ë‹¨ê³„**: `solar-1-mini-chat` + `n_samples=3` (ë¹ ë¥¸ í…ŒìŠ¤íŠ¸)
2. **ìµœì¢… ì œì¶œ**: `solar-pro2` + `n_samples=5` (ìµœê³  í’ˆì§ˆ)
3. **ì¤‘ë‹¨ ê°€ëŠ¥ì„± ë†’ì„ ë•Œ**: `--resume` í•­ìƒ ì‚¬ìš©
4. **CSVë¡œ ì§„í–‰ í™•ì¸**: `checkpoints/*.csv` íŒŒì¼ ì£¼ê¸°ì ìœ¼ë¡œ í™•ì¸
5. **Rate Limit ê±±ì • ì—†ìŒ**: v3.5 ìë™ ì¬ì‹œë„ ë¡œì§ ë‚´ì¥
