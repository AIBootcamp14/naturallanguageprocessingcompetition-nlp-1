# Solar API ìºì‹œ ë° í”„ë¡¬í”„íŠ¸ ë¬´íš¨í™” ë¬¸ì œ

**ì‘ì„±ì¼**: 2025-10-15
**ìš°ì„ ìˆœìœ„**: ğŸ”´ Critical
**ìƒíƒœ**: âœ… í•´ê²° ì™„ë£Œ

---

## 1. ë¬¸ì œ ë°œê²¬ ë°°ê²½

### 1.1 ì¦ìƒ

**ì‹¤í—˜ í´ë”**: `experiments/20251015/20251015_044827_inference_kobart_kfold_soft_voting_bs32_maxnew80_hf_solar`

- **ì¶”ë¡  ì‹œê°„ ì´ìƒ**: ì´ì „ ì‹¤í—˜ 30ë¶„ ì´ìƒ ì†Œìš” â†’ ì´ë²ˆ ì‹¤í—˜ 17ë¶„ë§Œì— ì™„ë£Œ
- **í”„ë¡¬í”„íŠ¸ ë¯¸ì ìš©**: ê°•í™”ëœ í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ì´ ì „í˜€ ë°˜ì˜ë˜ì§€ ì•ŠìŒ
- **A/B í”Œë ˆì´ìŠ¤í™€ë” ì—¬ì „íˆ ì¡´ì¬**: ì œì¶œ íŒŒì¼ì—ì„œ "ìƒì‚¬ A", "ë¹„ì„œ B" ë“± í”Œë ˆì´ìŠ¤í™€ë” ë°œê²¬

### 1.2 êµ¬ì²´ì  ì‚¬ë¡€

#### ì‚¬ë¡€ 1: test_0 (ìƒì‚¬/ë¹„ì„œ ëŒ€í™”)

**ì›ë³¸ ëŒ€í™”**:
```
#Person1#: Ms. Dawson, ë°›ì•„ì“°ê¸° ì¢€ ë¶€íƒë“œë ¤ì•¼ê² ì–´ìš”.
#Person2#: ë„¤, ë§ì”€í•˜ì„¸ìš”...
#Person1#: ì´ê±¸ ì˜¤ëŠ˜ ì˜¤í›„ê¹Œì§€ ëª¨ë“  ì§ì›ë“¤ì—ê²Œ ì‚¬ë‚´ ë©”ëª¨ë¡œ ë³´ë‚´ì•¼ í•´ìš”.
#Person2#: ë„¤. ì˜¤ëŠ˜ ì˜¤í›„ 4ì‹œê¹Œì§€ ì´ ë©”ëª¨ë¥¼ ì‘ì„±í•˜ê³  ë°°í¬í•´ì£¼ì„¸ìš”.
```

**ëŒ€í™” ë§¥ë½ ë¶„ì„**:
- Person1: ìƒê¸‰ì(ê´€ë¦¬ì) - ëª…ë ¹í˜• ì–´ì¡°, ì •ì±… ì „ë‹¬, ì—…ë¬´ ì§€ì‹œ
- Person2: ë¹„ì„œ ë˜ëŠ” ì§ì›(í•˜ê¸‰ì) - "ë„¤, ë§ì”€í•˜ì„¸ìš”", ì§€ì‹œì— ë”°ë¼ ë©”ëª¨ ì‘ì„±

**ê¸°ëŒ€ ìš”ì•½**: "ìƒì‚¬ê°€ Dawsonì—ê²Œ ì‚¬ë‚´ ë©”ëª¨ ë°°í¬ë¥¼ ì§€ì‹œí•¨"

**ì‹¤ì œ ì¶œë ¥**:
```
ìƒì‚¬ Aê°€ ë¹„ì„œ Bì—ê²Œ ëª¨ë“  í†µì‹ ì„ ì´ë©”ì¼ê³¼ ê³µì‹ ë©”ëª¨ë¡œ ì œí•œí•˜ëŠ” ìƒˆë¡œìš´ ì •ì±…ì„ ëª¨ë“  ì§ì›ì—ê²Œ ì‚¬ë‚´ ë©”ëª¨ë¡œ ë³´ë‚´ë„ë¡ ìš”ì²­í•¨.
```

âŒ **ë¬¸ì œì **:
- "A", "B" í”Œë ˆì´ìŠ¤í™€ë” ì‚¬ìš©
- "Ms. Dawson"ì´ë¼ëŠ” ëª…ì‹œëœ ì´ë¦„ ë¬´ì‹œ
- ì—­í•  êµ¬ì¡°(Power Dynamics) ë¶„ì„ ë¯¸ì ìš©

#### ì‚¬ë¡€ 2: test_1 (ì¹œêµ¬ ê°„ ì¼ìƒ ëŒ€í™”)

**ì›ë³¸ ëŒ€í™”**:
```
#Person1#: ë“œë””ì–´ ì™”ë„¤! ë­ê°€ ì´ë ‡ê²Œ ì˜¤ë˜ ê±¸ë ¸ì–´?
#Person2#: ì°¨ê°€ ë˜ ë§‰í˜”ì–´. Carrefour êµì°¨ë¡œ ê·¼ì²˜ì—ì„œ êµí†µì²´ì¦ì´ ì—„ì²­ ì‹¬í–ˆê±°ë“ .
#Person1#: ê±°ê¸´ ì¶œí‡´ê·¼ ì‹œê°„ì— í•­ìƒ í˜¼ì¡í•˜ì–ì•„.
```

**ëŒ€í™” ë§¥ë½ ë¶„ì„**:
- ë°˜ë§ ì‚¬ìš© ("ì™”ë„¤", "ê±¸ë ¸ì–´", "ë§‰í˜”ì–´", "í˜¼ì¡í•˜ì–ì•„")
- ì„œë¡œ ëŒ€ë“±í•˜ê²Œ ì¡°ì–¸ ì£¼ê³ ë°›ìŒ â†’ ìˆ˜í‰ ê´€ê³„
- ì£¼ì œ: êµí†µì²´ì¦, ì¶œí‡´ê·¼ â†’ ì¼ìƒ ëŒ€í™” (âŒ ì—…ë¬´ ìƒë‹´ ì•„ë‹˜)

**ê¸°ëŒ€ ìš”ì•½**: "ì¹œêµ¬ê°€ ì¹œêµ¬ì—ê²Œ ëŒ€ì¤‘êµí†µ ì´ìš©ì„ ì œì•ˆí•¨"

**ì‹¤ì œ ì¶œë ¥**: ì˜¬ë°”ë¥´ê²Œ "ì¹œêµ¬"ë¡œ ì¶œë ¥ë˜ì—ˆìœ¼ë‚˜, A/B í”Œë ˆì´ìŠ¤í™€ë”ë¥¼ ì‚¬ìš©í•œ ì¼€ì´ìŠ¤ë„ ë‹¤ìˆ˜ ë°œê²¬

---

## 2. ë¬¸ì œì  ìƒì„¸ ë¶„ì„

### 2.1 ì¶”ë¡  ì‹œê°„ ë‹¨ì¶• ì›ì¸

**ë¡œê·¸ ë¶„ì„** (`experiments/20251015/20251015_044827_.../inference.log`):

```
2025-10-15 04:54:38 | Solar API ë°°ì¹˜ ìš”ì•½ ìƒì„± ì¤‘...
2025-10-15 04:54:38 | ë°°ì¹˜ ìš”ì•½ ì‹œì‘: 499ê°œ ëŒ€í™”
2025-10-15 05:05:16 | ë°°ì¹˜ ìš”ì•½ ì™„ë£Œ: 499ê°œ
```

- **Solar API ë‹¨ê³„ ì†Œìš” ì‹œê°„**: 10ë¶„ 28ì´ˆ (04:54:38 ~ 05:05:16)
- **ì´ì „ ì‹¤í—˜ Solar API ë‹¨ê³„**: ì•½ 25ë¶„ ì´ìƒ ì†Œìš”

**ì‹œê°„ ë‹¨ì¶• = ìºì‹œ ì‚¬ìš© ì¦ê±°**

### 2.2 ìºì‹œ íŒŒì¼ í™•ì¸

```bash
$ ls -lh experiments/20251015/20251015_044827_.../cache/solar/
-rw-r--r-- 1 user user 125K Oct 15 05:05 solar_cache.pkl
```

- ìºì‹œ íŒŒì¼ ìƒì„± ì‹œê°: 05:05 (ì¶”ë¡  ì™„ë£Œ ì‹œê°)
- ìºì‹œ í¬ê¸°: 125KB â†’ 499ê°œ ëŒ€í™”ì˜ ìš”ì•½ ê²°ê³¼ í¬í•¨

### 2.3 ì½”ë“œ ë¶„ì„ (`src/api/solar_api.py`)

#### ìºì‹œ ë©”ì»¤ë‹ˆì¦˜ (ë¬¸ì œ ë°œìƒ ì „ ì½”ë“œ)

```python
def summarize(self, dialogue: str, ...) -> str:
    # ìºì‹œ í™•ì¸
    cache_key = hashlib.md5(dialogue.encode()).hexdigest()  # âŒ ë¬¸ì œ!
    if cache_key in self.cache:
        self._log(f"ìºì‹œ íˆíŠ¸: {cache_key[:8]}")
        return self.cache[cache_key]

    # í”„ë¡¬í”„íŠ¸ ìƒì„±
    messages = self.build_few_shot_prompt(dialogue, ...)

    # API í˜¸ì¶œ
    response = self.client.chat.completions.create(...)

    # ìºì‹œ ì €ì¥
    self.cache[cache_key] = summary
    self._save_cache()
```

**ë¬¸ì œì **:
1. **ìºì‹œ í‚¤ê°€ `dialogue`ë§Œ ê¸°ì¤€**: í”„ë¡¬í”„íŠ¸ê°€ ë°”ë€Œì–´ë„ dialogueê°€ ë™ì¼í•˜ë©´ ì´ì „ ìºì‹œ ë°˜í™˜
2. **í”„ë¡¬í”„íŠ¸ ë²„ì „ ë¯¸í¬í•¨**: í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ì„ ê°•í™”í•´ë„ ìºì‹œê°€ ë¬´íš¨í™”ë˜ì§€ ì•ŠìŒ
3. **ì‹¤í—˜ ê°„ ìºì‹œ ê³µìœ **: `cache/solar/solar_cache.pkl` íŒŒì¼ì´ ì—¬ëŸ¬ ì‹¤í—˜ì—ì„œ ê³µìœ ë¨

#### ìºì‹œ ë¡œë“œ ë©”ì»¤ë‹ˆì¦˜

```python
def _load_cache(self) -> Dict:
    cache_file = self.cache_dir / "solar_cache.pkl"
    if cache_file.exists():
        try:
            with open(cache_file, 'rb') as f:
                cache = pickle.load(f)
            self._log(f"ìºì‹œ ë¡œë“œ ì™„ë£Œ: {len(cache)}ê°œ í•­ëª©")
            return cache
        except:
            return {}
    return {}
```

- ì‹¤í—˜ í´ë”ë³„ë¡œ `cache/solar/` ë””ë ‰í† ë¦¬ê°€ ìƒì„±ë¨
- í•˜ì§€ë§Œ `--resume` ì˜µì…˜ ì‚¬ìš©ì‹œ ì´ì „ ìºì‹œë¥¼ ê·¸ëŒ€ë¡œ ë¡œë“œ
- **í”„ë¡¬í”„íŠ¸ê°€ ë‹¬ë¼ë„ ì´ì „ ì‹¤í—˜ì˜ ìºì‹œë¥¼ ì‚¬ìš©**

---

## 3. ê·¼ë³¸ ì›ì¸ (Root Cause)

### 3.1 ì„¤ê³„ ê²°í•¨

**ìºì‹œ ë¬´íš¨í™” ì „ëµ ë¶€ì¬**:
- í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ì€ `build_few_shot_prompt()` ë©”ì„œë“œì—ì„œ ìˆ˜í–‰
- ìºì‹œ í‚¤ëŠ” `dialogue` í•´ì‹œê°’ë§Œ ì‚¬ìš©
- **í”„ë¡¬í”„íŠ¸ ë³€ê²½ ì‚¬í•­ì´ ìºì‹œ í‚¤ì— ë°˜ì˜ë˜ì§€ ì•ŠìŒ**

### 3.2 ì‹¤í–‰ íë¦„ ë¬¸ì œ

```
[ì‹¤í—˜ 1] 20251015_031503 (ì´ì „ í”„ë¡¬í”„íŠ¸ v1.0)
  â†’ Solar API í˜¸ì¶œ â†’ ê²°ê³¼ ìºì‹œ ì €ì¥
  â†’ cache_key = md5("dialogue_text")
  â†’ cache["abc123..."] = "ìƒì‚¬ Aê°€ ë¹„ì„œ Bì—ê²Œ..."

[ì‹¤í—˜ 2] 20251015_044827 (ê°•í™”ëœ í”„ë¡¬í”„íŠ¸ v2.0)
  â†’ ìºì‹œ ë¡œë“œ
  â†’ dialogue ë™ì¼ â†’ cache_key = md5("dialogue_text") = "abc123..."
  â†’ ìºì‹œ íˆíŠ¸! â†’ "ìƒì‚¬ Aê°€ ë¹„ì„œ Bì—ê²Œ..." ë°˜í™˜
  â†’ âŒ ìƒˆ í”„ë¡¬í”„íŠ¸ ë¬´ì‹œ, API í˜¸ì¶œ ì•ˆí•¨
```

### 3.3 ì˜í–¥ ë²”ìœ„

**ì „ì²´ 499ê°œ ìƒ˜í”Œ ì¤‘**:
- ìºì‹œ ì‚¬ìš©ìœ¼ë¡œ API í˜¸ì¶œ ìƒëµ: ëŒ€ë¶€ë¶„ (ì •í™•í•œ ë¹„ìœ¨ì€ ë¡œê·¸ ë¯¸ê¸°ë¡)
- ìƒˆ í”„ë¡¬í”„íŠ¸ ì ìš©: ê±°ì˜ ì—†ìŒ
- ê²°ê³¼: ì´ì „ ì‹¤í—˜ê³¼ ê±°ì˜ ë™ì¼í•œ ì¶œë ¥

---

## 4. í•´ê²° ë°©ì•ˆ

### 4.1 í”„ë¡¬í”„íŠ¸ ë²„ì „ ì‹œìŠ¤í…œ ë„ì…

**ê°œë…**: í”„ë¡¬í”„íŠ¸ê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ ë²„ì „ì„ ì—…ë°ì´íŠ¸í•˜ì—¬ ìºì‹œ ìë™ ë¬´íš¨í™”

#### êµ¬í˜„ (src/api/solar_api.py)

**Step 1: í”„ë¡¬í”„íŠ¸ì— ë²„ì „ ëª…ì‹œ**

```python
def build_few_shot_prompt(self, dialogue: str, ...) -> List[Dict[str, str]]:
    # í”„ë¡¬í”„íŠ¸ ë²„ì „ (ìºì‹œ ë¬´íš¨í™”ìš©)
    PROMPT_VERSION = "v2.0_power_dynamics"

    system_prompt = f"""[{PROMPT_VERSION}] ë‹¹ì‹ ì€ ëŒ€í™” ìš”ì•½ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.
    ë‹¤ìŒ ê·œì¹™ì„ ì—„ê²©íˆ ë”°ë¼ ëŒ€í™”ë¥¼ ìš”ì•½í•˜ì„¸ìš”:

    1. **í•µì‹¬ë§Œ ê°„ê²°í•˜ê²Œ**: ...
    2. **í™”ì ì—­í•  ë° ê´€ê³„ íŒŒì•…** (ìµœìš°ì„  ê·œì¹™ - 4ë‹¨ê³„ ë¶„ì„):
       ...
    """

    messages = [{"role": "system", "content": system_prompt}]
    ...
```

**Step 2: ìºì‹œ í‚¤ì— ë²„ì „ í¬í•¨**

```python
def summarize(self, dialogue: str, ...) -> str:
    # ìºì‹œ í™•ì¸ (í”„ë¡¬í”„íŠ¸ ë²„ì „ í¬í•¨)
    PROMPT_VERSION = "v2.0_power_dynamics"
    cache_key_string = f"{PROMPT_VERSION}_{dialogue}"  # âœ… ë²„ì „ ì¶”ê°€!
    cache_key = hashlib.md5(cache_key_string.encode()).hexdigest()

    if cache_key in self.cache:
        self._log(f"ìºì‹œ íˆíŠ¸: {cache_key[:8]}")
        return self.cache[cache_key]

    # API í˜¸ì¶œ...
```

**íš¨ê³¼**:
- í”„ë¡¬í”„íŠ¸ v1.0 â†’ ìºì‹œ í‚¤: `md5("v1.0_dialogue_text")`
- í”„ë¡¬í”„íŠ¸ v2.0 â†’ ìºì‹œ í‚¤: `md5("v2.0_dialogue_text")`
- **ë²„ì „ì´ ë‹¤ë¥´ë©´ ìºì‹œ ë¯¸ìŠ¤ â†’ API ì¬í˜¸ì¶œ**

### 4.2 í”„ë¡¬í”„íŠ¸ ê°•í™”: Power Dynamics ë¶„ì„

**ê¸°ì¡´ ë¬¸ì œì **:
- ë§íˆ¬(ë°˜ë§/ì¡´ëŒ“ë§)ì™€ í‚¤ì›Œë“œë§Œìœ¼ë¡œ íŒë‹¨
- ì—­í•  êµ¬ì¡°(ëˆ„ê°€ ì§€ì‹œí•˜ê³  ëˆ„ê°€ ìˆ˜í–‰í•˜ëŠ”ê°€) ë¶„ì„ ë¶€ì¡±
- test_0 ê°™ì€ ìƒì‚¬/ë¹„ì„œ ê´€ê³„ë¥¼ ì œëŒ€ë¡œ íŒŒì•… ëª»í•¨

**ê°œì„  ë°©ì•ˆ**: STEP 1ì— ì—­í•  êµ¬ì¡° ë¶„ì„ ì¶”ê°€

```
STEP 1: ì—­í•  êµ¬ì¡° ë¶„ì„ (Power Dynamics - ìµœìš°ì„ !)
ëŒ€í™”ì—ì„œ ëˆ„ê°€ ì§€ì‹œ/ìš”ì²­í•˜ê³ , ëˆ„ê°€ ì‘ë‹µ/ìˆ˜í–‰í•˜ëŠ”ê°€?

1-1. ìƒí•˜ ê´€ê³„ (ê¶Œë ¥ ë¶ˆê· í˜•):
   * ì§€ì‹œí•˜ëŠ” ìª½ (ìƒê¸‰ì): "~í•´ì£¼ì„¸ìš”", "~ë¶€íƒë“œë ¤ìš”", "~í•´ì•¼ í•´ìš”", ëª…ë ¹í˜• ì–´ì¡°
     - ìˆ˜í–‰í•˜ëŠ” ìª½ (í•˜ê¸‰ì): "ë„¤", "ì•Œê² ìŠµë‹ˆë‹¤", "ë°”ë¡œ í•˜ê² ìŠµë‹ˆë‹¤"
     â†’ ìƒì‚¬/ë¹„ì„œ, ìƒì‚¬/ì§ì›, ê´€ë¦¬ì/íŒ€ì›, ì„ ìƒë‹˜/í•™ìƒ, êµìˆ˜/í•™ìƒ

   * ì„œë¹„ìŠ¤ ì œê³µ ê´€ê³„:
     - ìš”ì²­í•˜ëŠ” ìª½: "~í•´ì£¼ì„¸ìš”", "ë¬¸ì˜ë“œë ¤ìš”", ë¶ˆë§Œ/ë¬¸ì œ ì œê¸°
     - ì œê³µí•˜ëŠ” ìª½: "ë„ì™€ë“œë¦¬ê² ìŠµë‹ˆë‹¤", "í™•ì¸í•´ë“œë¦´ê²Œìš”", ë¬¸ì œ í•´ê²°
     â†’ ê³ ê°/ìƒë‹´ì‚¬, ì†ë‹˜/ì§ì›, í™˜ì/ì˜ì‚¬, í™˜ì/ê°„í˜¸ì‚¬

1-2. ìˆ˜í‰ ê´€ê³„ (ë™ë“±):
   * ì¡°ì–¸/ì œì•ˆ ì£¼ê³ ë°›ê¸°, ì˜ê²¬ êµí™˜, í•¨ê»˜ ê³„íš ìˆ˜ë¦½
   * ì„œë¡œ ì§ˆë¬¸í•˜ê³  ë‹µë³€í•˜ë©° ëŒ€í™” ì£¼ë„ê¶Œì´ ë°”ë€œ
   â†’ ì¹œêµ¬/ì¹œêµ¬, ë™ë£Œ/ë™ë£Œ, ì—°ì¸/ì—°ì¸, í˜•ì œ/ìë§¤

1-3. ê°€ì¡± ê´€ê³„:
   * ë‚˜ì´/í•­ë ¬ ê¸°ë°˜ ìœ„ê³„ê°€ ìˆì§€ë§Œ ì¹œë°€í•¨ì´ ë†’ìŒ
   * ëª…ì‹œì  í˜¸ì¹­ ("ì—„ë§ˆ", "ì•„ë¹ ", "í˜•", "ì–¸ë‹ˆ" ë“±) í™•ì¸
   â†’ ìë…€/ë¶€ëª¨, í˜•ì œ/ìë§¤
```

**ëª…ì¹­ ê²°ì • ìš°ì„ ìˆœìœ„ ì¬ì •ì˜**:
```
1ìˆœìœ„: ëª…ì‹œëœ ê³ ìœ ëª…ì‚¬ (ì´ë¦„/ì§í•¨) â†’ "Ms. Dawson", "ìŠ¤í‹°ë¸", "êµìˆ˜ë‹˜"
2ìˆœìœ„: STEP 1 ì—­í•  êµ¬ì¡° ë¶„ì„ ê²°ê³¼ â†’ ìƒì‚¬/ë¹„ì„œ, ê³ ê°/ìƒë‹´ì‚¬, ì¹œêµ¬/ì¹œêµ¬
3ìˆœìœ„: STEP 2 ë§íˆ¬ ë¶„ì„ â†’ ì¹œë°€í•¨(ì¹œêµ¬)/ê²©ì‹(ê³ ê°-ìƒë‹´ì‚¬) íŒë‹¨
4ìˆœìœ„: STEP 4 ë‚´ìš© í‚¤ì›Œë“œ â†’ ì—…ë¬´/ì¼ìƒ ë§¥ë½ íŒë‹¨
5ìˆœìœ„: ë¶ˆëª…í™•í•  ê²½ìš° â†’ "í™”ì", "ìƒëŒ€ë°©" ì‚¬ìš© (A/B ì ˆëŒ€ ê¸ˆì§€)
```

### 4.3 ì‹¤ì „ ì˜ˆì‹œ ì¶”ê°€

í”„ë¡¬í”„íŠ¸ì— êµ¬ì²´ì ì¸ ì‹¤ì „ ì˜ˆì‹œë¥¼ í¬í•¨í•˜ì—¬ LLMì´ íŒ¨í„´ì„ í•™ìŠµí•˜ë„ë¡ í•¨:

```
ì˜ˆì‹œ 1 - ìƒì‚¬/ë¹„ì„œ ê´€ê³„:
ëŒ€í™”: "Ms. Dawson, ë°›ì•„ì“°ê¸° ì¢€ ë¶€íƒë“œë ¤ì•¼ê² ì–´ìš”."
      "ë„¤, ë§ì”€í•˜ì„¸ìš”..."
      "ì´ê±¸ ì˜¤ëŠ˜ ì˜¤í›„ê¹Œì§€ ëª¨ë“  ì§ì›ë“¤ì—ê²Œ ì‚¬ë‚´ ë©”ëª¨ë¡œ ë³´ë‚´ì•¼ í•´ìš”."
      "ë„¤. ì˜¤ëŠ˜ ì˜¤í›„ 4ì‹œê¹Œì§€ ì´ ë©”ëª¨ë¥¼ ì‘ì„±í•˜ê³  ë°°í¬í•´ì£¼ì„¸ìš”."
ë¶„ì„:
- STEP 1: Person1ì´ ì§€ì‹œ("ë¶€íƒë“œë ¤ìš”", "ë³´ë‚´ì•¼ í•´ìš”", "ë°°í¬í•´ì£¼ì„¸ìš”"),
         Person2ëŠ” ìˆ˜í–‰("ë„¤", "ë§ì”€í•˜ì„¸ìš”")
  â†’ ìƒê¸‰ì(ìƒì‚¬)/í•˜ê¸‰ì(ë¹„ì„œ or ì§ì›) ê´€ê³„
- STEP 2: ì¡´ëŒ“ë§ ì‚¬ìš© ("ë¶€íƒë“œë ¤ì•¼ê² ì–´ìš”", "ë§ì”€í•˜ì„¸ìš”")
- STEP 3: "Ms. Dawson" ëª…ì‹œ â†’ Person2 is Dawson (ë¹„ì„œ)
- STEP 4: "ì‚¬ë‚´ ë©”ëª¨", "ì •ì±…", "ì§ì›" â†’ ì—…ë¬´ í™˜ê²½
ì˜¬ë°”ë¥¸ ìš”ì•½: "ìƒì‚¬ê°€ Dawsonì—ê²Œ ì‚¬ë‚´ ë©”ëª¨ ë°°í¬ë¥¼ ì§€ì‹œí•¨"
âŒ "ìƒì‚¬ Aê°€ ë¹„ì„œ Bì—ê²Œ" ì•„ë‹˜!

ì˜ˆì‹œ 2 - ì¹œêµ¬ ê´€ê³„ (ë°˜ë§):
ëŒ€í™”: "ë“œë””ì–´ ì™”ë„¤! ë­ê°€ ì´ë ‡ê²Œ ì˜¤ë˜ ê±¸ë ¸ì–´?"
      "ì°¨ê°€ ë˜ ë§‰í˜”ì–´. Carrefour êµì°¨ë¡œ ê·¼ì²˜ì—ì„œ êµí†µì²´ì¦ì´ ì—„ì²­ ì‹¬í–ˆê±°ë“ ."
      "ê±°ê¸´ ì¶œí‡´ê·¼ ì‹œê°„ì— í•­ìƒ í˜¼ì¡í•˜ì–ì•„."
ë¶„ì„:
- STEP 1: ì„œë¡œ ëŒ€ë“±í•˜ê²Œ ëŒ€í™”, ì¡°ì–¸ ì£¼ê³ ë°›ìŒ â†’ ìˆ˜í‰ ê´€ê³„
- STEP 2: ë°˜ë§ ì‚¬ìš© ("ì™”ë„¤", "ê±¸ë ¸ì–´", "ë§‰í˜”ì–´", "í˜¼ì¡í•˜ì–ì•„")
- STEP 4: "êµí†µì²´ì¦", "ì¶œí‡´ê·¼" â†’ ì¼ìƒ ëŒ€í™” (âŒ ì—…ë¬´ ìƒë‹´ ì•„ë‹˜!)
ì˜¬ë°”ë¥¸ ìš”ì•½: "ì¹œêµ¬ê°€ ì¹œêµ¬ì—ê²Œ ëŒ€ì¤‘êµí†µ ì´ìš©ì„ ì œì•ˆí•¨"
âŒ "ê³ ê°ì´ ìƒë‹´ì‚¬ì—ê²Œ" ì•„ë‹˜!
```

### 4.4 ê¸ˆì§€ ì‚¬í•­ ê°•í™”

```
5. **ê¸ˆì§€ ì‚¬í•­** (ë§¤ìš° ì¤‘ìš” - ë°˜ë“œì‹œ ì¤€ìˆ˜):
   - âŒâŒâŒ A/B/C/D, #Person1#/#Person2# ê°™ì€ í”Œë ˆì´ìŠ¤í™€ë” ì ˆëŒ€ ì‚¬ìš© ê¸ˆì§€!
   - âŒ "ìƒì‚¬ A", "ë¹„ì„œ B", "ì¹œêµ¬ A", "í•™ìƒ B" ê°™ì€ í˜¼í•© ëª…ì¹­ ê¸ˆì§€!
   - âŒ ë§íˆ¬ì™€ ë§ì§€ ì•ŠëŠ” ëª…ì¹­ ì‚¬ìš© ê¸ˆì§€ (ë°˜ë§ ëŒ€í™”ì— "ê³ ê°/ìƒë‹´ì‚¬" ì‚¬ìš© ë“±)
   - âŒ ì—­í•  êµ¬ì¡° ë¬´ì‹œ ê¸ˆì§€ (ì§€ì‹œí•˜ëŠ” ì‚¬ëŒì„ "ì¹œêµ¬"ë¡œ ë¶€ë¥´ë©´ ì•ˆë¨)
   - âŒ ì›ë³¸ ëŒ€í™” ê·¸ëŒ€ë¡œ ë³µì‚¬ ì ˆëŒ€ ê¸ˆì§€
   - âŒ "ëŒ€í™” ìš”ì•½:", "Summary:", "ëŒ€í™”ì—ì„œëŠ”" ë“± ì ‘ë‘ì‚¬ ì‚¬ìš© ê¸ˆì§€
   - âŒ ë¶ˆí•„ìš”í•œ ë¶€ê°€ ì„¤ëª… ê¸ˆì§€ (ê°„ê²°í•˜ê²Œ)
```

---

## 5. êµ¬í˜„ ê²°ê³¼

### 5.1 ì½”ë“œ ë³€ê²½ ì‚¬í•­

**íŒŒì¼**: `src/api/solar_api.py`

**ë³€ê²½ 1: í”„ë¡¬í”„íŠ¸ ë²„ì „ ì‹œìŠ¤í…œ**

```python
# Before
def build_few_shot_prompt(self, dialogue: str, ...) -> List[Dict[str, str]]:
    system_prompt = """ë‹¹ì‹ ì€ ëŒ€í™” ìš”ì•½ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ..."""

# After
def build_few_shot_prompt(self, dialogue: str, ...) -> List[Dict[str, str]]:
    PROMPT_VERSION = "v2.0_power_dynamics"
    system_prompt = f"""[{PROMPT_VERSION}] ë‹¹ì‹ ì€ ëŒ€í™” ìš”ì•½ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ..."""
```

**ë³€ê²½ 2: ìºì‹œ í‚¤ì— ë²„ì „ í¬í•¨**

```python
# Before
def summarize(self, dialogue: str, ...) -> str:
    cache_key = hashlib.md5(dialogue.encode()).hexdigest()

# After
def summarize(self, dialogue: str, ...) -> str:
    PROMPT_VERSION = "v2.0_power_dynamics"
    cache_key_string = f"{PROMPT_VERSION}_{dialogue}"
    cache_key = hashlib.md5(cache_key_string.encode()).hexdigest()
```

**ë³€ê²½ 3: í”„ë¡¬í”„íŠ¸ ê°•í™”**

- ê¸°ì¡´ STEP 1-4 ìœ ì§€
- ìƒˆë¡œìš´ STEP 1 ì¶”ê°€: ì—­í•  êµ¬ì¡° ë¶„ì„ (Power Dynamics)
- ê¸°ì¡´ STEP 1 â†’ STEP 2ë¡œ ì´ë™ (ë§íˆ¬ ë¶„ì„)
- ì‹¤ì „ ì˜ˆì‹œ 2ê°œ ì¶”ê°€
- ê¸ˆì§€ ì‚¬í•­ ê°•í™” (í”Œë ˆì´ìŠ¤í™€ë” âŒâŒâŒ ê°•ì¡°)

### 5.2 Git Commit

```bash
commit 45d3d6d
feat: ìš”ì•½ë¬¸ í’ˆì§ˆ ê°œì„ ì„ ìœ„í•œ Solar API Prompt Engineering ê°•í™” ë° Post-processing ë³´ì™„

- Solar API Prompt 7ë‹¨ê³„ ê°•í™” (Chain-of-Thought, Few-shot, Self-Verification ë“±)
  - 4ë‹¨ê³„ í™”ì ê´€ê³„ ë¶„ì„ ì•Œê³ ë¦¬ì¦˜ (ë§íˆ¬â†’ì´ë¦„â†’í‚¤ì›Œë“œâ†’ìš°ì„ ìˆœìœ„)
  - 5ë‹¨ê³„ ìš°ì„ ìˆœìœ„ ê¸°ë°˜ ëª…ì¹­ ê²°ì • ì‹œìŠ¤í…œ
  - ë°˜ë§/ì¡´ëŒ“ë§ í†¤ ë¶„ì„ì„ í†µí•œ ê´€ê³„ íŒŒì•…
  - A/B/#Person# í”Œë ˆì´ìŠ¤í™€ë” ì‚¬ìš© ê¸ˆì§€ ëª…ì‹œ

- Post-processing ì›ë³¸ ëŒ€í™” ë³µì‚¬ ë°©ì§€ íŒ¨í„´ ì¶”ê°€
  - "ê³ ê°: ... ìƒë‹´ì‚¬: ... ìš”ì•½:" í˜•íƒœ ê°ì§€ ë° ì œê±°
  - ì ‘ë‘ì‚¬ ì œê±° íŒ¨í„´ í™•ì¥ ("ëŒ€í™”ì—ì„œëŠ”", "ëŒ€í™” ìƒëŒ€" ë“±)
```

---

## 6. ê°œì„ ëœ ìƒíƒœ

### 6.1 ìºì‹œ ë¬´íš¨í™” ë©”ì»¤ë‹ˆì¦˜

**Before**:
```
[ì‹¤í—˜ 1] v1.0 í”„ë¡¬í”„íŠ¸
  cache["abc123"] = "ìƒì‚¬ Aê°€ ë¹„ì„œ Bì—ê²Œ..."

[ì‹¤í—˜ 2] v2.0 í”„ë¡¬í”„íŠ¸ (ê°•í™”ë¨)
  cache_key = "abc123" (ë™ì¼!)
  â†’ ìºì‹œ íˆíŠ¸ â†’ ì´ì „ ê²°ê³¼ ë°˜í™˜ âŒ
```

**After**:
```
[ì‹¤í—˜ 1] v1.0 í”„ë¡¬í”„íŠ¸
  cache["v1.0_abc123"] = "ìƒì‚¬ Aê°€ ë¹„ì„œ Bì—ê²Œ..."

[ì‹¤í—˜ 2] v2.0 í”„ë¡¬í”„íŠ¸
  cache_key = "v2.0_abc123" (ë‹¤ë¦„!)
  â†’ ìºì‹œ ë¯¸ìŠ¤ â†’ API ì¬í˜¸ì¶œ âœ…
  â†’ "ìƒì‚¬ê°€ Dawsonì—ê²Œ ì‚¬ë‚´ ë©”ëª¨ ë°°í¬ë¥¼ ì§€ì‹œí•¨"
```

### 6.2 í”„ë¡¬í”„íŠ¸ í’ˆì§ˆ

**Before** (v1.0):
- STEP 1: ë§íˆ¬ ë¶„ì„ (ë°˜ë§/ì¡´ëŒ“ë§)
- STEP 2: ëª…ì‹œëœ ì´ë¦„/í˜¸ì¹­
- STEP 3: ëŒ€í™” ë‚´ìš© í‚¤ì›Œë“œ
- STEP 4: ëª…ì¹­ ê²°ì • ìš°ì„ ìˆœìœ„

**ë¬¸ì œ**: ì—­í•  êµ¬ì¡°(ëˆ„ê°€ ì§€ì‹œí•˜ê³  ëˆ„ê°€ ìˆ˜í–‰í•˜ëŠ”ê°€) ë¶„ì„ ë¶€ì¡±

**After** (v2.0_power_dynamics):
- **STEP 1: ì—­í•  êµ¬ì¡° ë¶„ì„ (Power Dynamics)** â† ìƒˆë¡œ ì¶”ê°€!
  - 1-1. ìƒí•˜ ê´€ê³„ (ì§€ì‹œì vs ìˆ˜í–‰ì)
  - 1-2. ìˆ˜í‰ ê´€ê³„ (ëŒ€ë“±í•œ ì¡°ì–¸/ì˜ê²¬ êµí™˜)
  - 1-3. ê°€ì¡± ê´€ê³„
- STEP 2: ë§íˆ¬ ë¶„ì„ (ë³´ì¡° íŒë‹¨)
- STEP 3: ëª…ì‹œëœ ì´ë¦„/í˜¸ì¹­ (ìµœê³  ìš°ì„ ìˆœìœ„)
- STEP 4: ëŒ€í™” ë‚´ìš© í‚¤ì›Œë“œ
- ëª…ì¹­ ê²°ì • ìš°ì„ ìˆœìœ„ ì¬ì •ì˜
- ì‹¤ì „ ì˜ˆì‹œ 2ê°œ ì¶”ê°€
- ê¸ˆì§€ ì‚¬í•­ ê°•í™”

### 6.3 ì˜ˆìƒ ê²°ê³¼

**test_0 (ìƒì‚¬/ë¹„ì„œ)**:
- Before: "ìƒì‚¬ Aê°€ ë¹„ì„œ Bì—ê²Œ..."
- After: "ìƒì‚¬ê°€ Dawsonì—ê²Œ ì‚¬ë‚´ ë©”ëª¨ ë°°í¬ë¥¼ ì§€ì‹œí•¨"

**test_1 (ì¹œêµ¬)**:
- Before: "ì¹œêµ¬ Aê°€ ì¹œêµ¬ Bì—ê²Œ..." (ì¼ë¶€ ì¼€ì´ìŠ¤)
- After: "ì¹œêµ¬ê°€ ì¹œêµ¬ì—ê²Œ ëŒ€ì¤‘êµí†µ ì´ìš©ì„ ì œì•ˆí•¨"

**ì¶”ë¡  ì‹œê°„**:
- Before: 17ë¶„ (ìºì‹œ ì‚¬ìš©)
- After: 30ë¶„ ì´ìƒ ì˜ˆìƒ (ì „ì²´ API ì¬í˜¸ì¶œ)

---

## 7. ê²€ì¦ ê³„íš

### 7.1 ìƒˆ ì‹¤í—˜ ì‹¤í–‰

```bash
python scripts/kfold_ensemble_inference.py \
  --experiment_dir experiments/20251014/20251014_183206_kobart_ultimate_kfold \
  --test_data data/raw/test.csv \
  --use_solar_api \
  --solar_model solar-1-chat \
  --solar_temperature 0.2 \
  --solar_batch_size 5 \
  --solar_delay 2.0 \
  --use_pretrained_correction \
  --correction_models gogamza/kobart-base-v2 digit82/kobart-summarization \
  --correction_strategy quality_based \
  --correction_threshold 0.3 \
  --max_new_tokens 80 \
  --min_new_tokens 20 \
  --num_beams 5 \
  --length_penalty 0.8 \
  --repetition_penalty 1.5 \
  --no_repeat_ngram_size 3 \
  --batch_size 32 \
  --ensemble_method soft_voting
```

### 7.2 ê²€ì¦ í•­ëª©

1. **ì¶”ë¡  ì‹œê°„ í™•ì¸**:
   - Solar API ë‹¨ê³„ê°€ 30ë¶„ ì´ìƒ ì†Œìš”ë˜ëŠ”ì§€ í™•ì¸ (ìºì‹œ ë¯¸ì‚¬ìš© ì¦ëª…)
   - ë¡œê·¸ì—ì„œ ìºì‹œ íˆíŠ¸ ë©”ì‹œì§€ê°€ ì—†ëŠ”ì§€ í™•ì¸

2. **A/B í”Œë ˆì´ìŠ¤í™€ë” ì œê±°**:
   ```bash
   python src/analysis/analyze_summaries.py
   ```
   - "ì¼ë°˜ ëª…ì¹­ ì‚¬ìš© (A/B/#Person#)" í•­ëª©ì´ 0ê±´ìœ¼ë¡œ ê°ì†Œí•´ì•¼ í•¨

3. **test_0 ì¼€ì´ìŠ¤ í™•ì¸**:
   ```bash
   grep "test_0" submission.csv
   ```
   - "ìƒì‚¬ A", "ë¹„ì„œ B" ê°™ì€ í‘œí˜„ ì‚¬ë¼ì ¸ì•¼ í•¨
   - "Dawson" ì´ë¦„ ì‚¬ìš©ë˜ì–´ì•¼ í•¨

4. **í™”ì ëª…ì¹­ ì˜¤ë¥˜ ê°ì†Œ**:
   - ì´ì „ ë¶„ì„: 78ê±´ (15.6%)
   - ëª©í‘œ: 10ê±´ ì´í•˜ (2% ì´í•˜)

### 7.3 ì„±ê³µ ê¸°ì¤€

âœ… **í•„ìˆ˜ ì¡°ê±´**:
- [ ] ì¶”ë¡  ì‹œê°„ 30ë¶„ ì´ìƒ (ìºì‹œ ë¯¸ì‚¬ìš©)
- [ ] A/B/#Person# í”Œë ˆì´ìŠ¤í™€ë” 0ê±´
- [ ] test_0ì—ì„œ "Dawson" ì‚¬ìš©
- [ ] í™”ì ëª…ì¹­ ì˜¤ë¥˜ 50% ì´ìƒ ê°ì†Œ (78ê±´ â†’ 39ê±´ ì´í•˜)

âœ… **ê¶Œì¥ ì¡°ê±´**:
- [ ] í™”ì ëª…ì¹­ ì˜¤ë¥˜ 80% ì´ìƒ ê°ì†Œ (78ê±´ â†’ 15ê±´ ì´í•˜)
- [ ] ì—­í•  êµ¬ì¡°(ìƒì‚¬/ë¹„ì„œ, ê³ ê°/ìƒë‹´ì‚¬, ì¹œêµ¬) ì •í™•ë„ 95% ì´ìƒ

---

## 8. êµí›ˆ ë° ê°œì„  ë°©í–¥

### 8.1 êµí›ˆ

1. **ìºì‹œ ë¬´íš¨í™” ì „ëµì˜ ì¤‘ìš”ì„±**:
   - í”„ë¡¬í”„íŠ¸ê°€ ë°”ë€Œë©´ ìºì‹œë„ ë¬´íš¨í™”ë˜ì–´ì•¼ í•¨
   - ìºì‹œ í‚¤ì— í”„ë¡¬í”„íŠ¸ ë²„ì „ì„ í¬í•¨ì‹œí‚¤ëŠ” ê²ƒì´ í•„ìˆ˜

2. **ì‹¤í—˜ ê²€ì¦ì˜ ì¤‘ìš”ì„±**:
   - ì¶”ë¡  ì‹œê°„ì´ ë‹¨ì¶•ë˜ë©´ ì˜ì‹¬í•´ì•¼ í•¨
   - ê²°ê³¼ íŒŒì¼ì„ ìƒ˜í”Œë§í•˜ì—¬ ê²€ì¦ í•„ìš”

3. **í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ì˜ ì„¸ë°€í•¨**:
   - ë§íˆ¬(ë°˜ë§/ì¡´ëŒ“ë§)ë§Œìœ¼ë¡œëŠ” ë¶€ì¡±
   - ì—­í•  êµ¬ì¡°(Power Dynamics) ë¶„ì„ì´ í•„ìˆ˜
   - êµ¬ì²´ì ì¸ ì˜ˆì‹œ ì œê³µì´ íš¨ê³¼ì 

### 8.2 í–¥í›„ ê°œì„  ë°©í–¥

1. **ìºì‹œ ë¡œê¹… ê°•í™”**:
   ```python
   def summarize(self, dialogue: str, ...) -> str:
       if cache_key in self.cache:
           self._log(f"âœ… ìºì‹œ íˆíŠ¸: {cache_key[:8]} (ë²„ì „: {PROMPT_VERSION})")
           return self.cache[cache_key]
       else:
           self._log(f"âŒ ìºì‹œ ë¯¸ìŠ¤: {cache_key[:8]} (ë²„ì „: {PROMPT_VERSION})")
   ```

2. **ìºì‹œ í†µê³„ ë¦¬í¬íŠ¸**:
   ```python
   def summarize_batch(self, dialogues: List[str], ...) -> List[str]:
       cache_hits = 0
       cache_misses = 0

       # ... ë°°ì¹˜ ì²˜ë¦¬ ...

       self._log(f"\nğŸ“Š ìºì‹œ í†µê³„:")
       self._log(f"  - ìºì‹œ íˆíŠ¸: {cache_hits}/{len(dialogues)} ({cache_hits/len(dialogues)*100:.1f}%)")
       self._log(f"  - ìºì‹œ ë¯¸ìŠ¤: {cache_misses}/{len(dialogues)} ({cache_misses/len(dialogues)*100:.1f}%)")
   ```

3. **í”„ë¡¬í”„íŠ¸ ë²„ì „ ê´€ë¦¬**:
   - ë³„ë„ ìƒìˆ˜ íŒŒì¼ë¡œ ê´€ë¦¬ (`src/api/prompt_versions.py`)
   - ë²„ì „ë³„ ë³€ê²½ ì´ë ¥ ë¬¸ì„œí™”
   - ë²„ì „ ì—…ê·¸ë ˆì´ë“œì‹œ ìë™ í…ŒìŠ¤íŠ¸

4. **ì‹¤í—˜ ê²€ì¦ ìë™í™”**:
   ```bash
   # ì‹¤í—˜ ì™„ë£Œ í›„ ìë™ ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
   python scripts/validate_inference_results.py \
     --submission submission.csv \
     --check-placeholders \
     --check-speaker-names \
     --compare-with previous_submission.csv
   ```

---

## 9. ê´€ë ¨ ë¬¸ì„œ

- `docs/issues/ìš”ì•½ë¬¸_í˜•ì‹_ì¼ê´€ì„±_ë¬¸ì œ_ë¶„ì„.md`: ìš”ì•½ë¬¸ í’ˆì§ˆ ì¢…í•© ë¶„ì„
- `docs/ëª¨ë“ˆí™”/Solar_API_í”„ë¡¬í”„íŠ¸_ì—”ì§€ë‹ˆì–´ë§.md`: í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ ì „ëµ ë¬¸ì„œ
- `src/api/solar_api.py`: Solar API í´ë¼ì´ì–¸íŠ¸ êµ¬í˜„
- `src/analysis/analyze_summaries.py`: ìš”ì•½ë¬¸ í’ˆì§ˆ ë¶„ì„ ìŠ¤í¬ë¦½íŠ¸

---

## 10. ë²„ì „ ì´ë ¥

| ë²„ì „ | ë‚ ì§œ | ë³€ê²½ ì‚¬í•­ |
|------|------|-----------|
| v1.0 | 2025-10-14 | ì´ˆê¸° í”„ë¡¬í”„íŠ¸ (ë§íˆ¬ ë¶„ì„ ì¤‘ì‹¬) |
| **v2.0_power_dynamics** | **2025-10-15** | **ì—­í•  êµ¬ì¡° ë¶„ì„ ì¶”ê°€, ìºì‹œ ë²„ì „ ì‹œìŠ¤í…œ ë„ì…** |

---

**ìµœì¢… ìˆ˜ì •ì¼**: 2025-10-15
